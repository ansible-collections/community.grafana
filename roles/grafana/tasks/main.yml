---
- name: Group tasks for authentication parameters
  module_defaults:
    group/community.grafana.grafana:
      url: "{{ grafana_url }}"
      url_username: "{{ grafana_username }}"
      url_password: "{{ grafana_password }}"
      use_proxy: "{{ grafana_use_proxy | default(omit) }}"
      validate_certs: "{{ grafana_validate_certs | default(omit) }}"
  block:
    - name: Manage organization  # noqa: args[module]
      community.grafana.grafana_organization:
        name: "{{ organization.name }}"
        state: "{{ organization.state | default(omit) }}"
      loop: "{{ grafana_organizations }}"
      loop_control: {loop_var: organization}
      tags: organization

    - name: Manage notification channel
      community.grafana.grafana_notification_channel:
        dingding_message_type: "{{ notification_channel.dingding_message_type | default(omit) }}"
        dingding_url: "{{ notification_channel.dingding_url | default(omit) }}"
        disable_resolve_message: "{{ notification_channel.disable_resolve_message | default(omit) }}"
        discord_message_content: "{{ notification_channel.discord_message_content | default(omit) }}"
        discord_url: "{{ notification_channel.discord_url | default(omit) }}"
        email_addresses: "{{ notification_channel.email_addresses | default(omit) }}"
        email_single: "{{ notification_channel.email_single | default(omit) }}"
        googlechat_url: "{{ notification_channel.googlechat_url | default(omit) }}"
        hipchat_api_key: "{{ notification_channel.hipchat_api_key | default(omit) }}"
        hipchat_room_id: "{{ notification_channel.hipchat_room_id | default(omit) }}"
        hipchat_url: "{{ notification_channel.hipchat_url | default(omit) }}"
        include_image: "{{ notification_channel.include_image | default(omit) }}"
        is_default: "{{ notification_channel.is_default | default(omit) }}"
        kafka_topic: "{{ notification_channel.kafka_topic | default(omit) }}"
        kafka_url: "{{ notification_channel.kafka_url | default(omit) }}"
        line_token: "{{ notification_channel.line_token | default(omit) }}"
        name: "{{ notification_channel.name }}"
        opsgenie_api_key: "{{ notification_channel.opsgenie_api_key | default(omit) }}"
        opsgenie_auto_close: "{{ notification_channel.opsgenie_auto_close | default(omit) }}"
        opsgenie_override_priority: "{{ notification_channel.opsgenie_override_priority | default(omit) }}"
        opsgenie_url: "{{ notification_channel.opsgenie_url | default(omit) }}"
        org_id: "{{ notification_channel.org_id | default(omit) }}"
        pagerduty_auto_resolve: "{{ notification_channel.pagerduty_auto_resolve | default(omit) }}"
        pagerduty_integration_key: "{{ notification_channel.pagerduty_integration_key | default(omit) }}"
        pagerduty_message_in_details: "{{ notification_channel.pagerduty_message_in_details | default(omit) }}"
        pagerduty_severity: "{{ notification_channel.pagerduty_severity | default(omit) }}"
        prometheus_password: "{{ notification_channel.prometheus_password | default(omit) }}"
        prometheus_url: "{{ notification_channel.prometheus_url | default(omit) }}"
        prometheus_username: "{{ notification_channel.prometheus_username | default(omit) }}"
        pushover_alert_sound: "{{ notification_channel.pushover_alert_sound | default(omit) }}"
        pushover_api_token: "{{ notification_channel.pushover_api_token | default(omit) }}"
        pushover_devices: "{{ notification_channel.pushover_devices | default(omit) }}"
        pushover_expire: "{{ notification_channel.pushover_expire | default(omit) }}"
        pushover_ok_sound: "{{ notification_channel.pushover_ok_sound | default(omit) }}"
        pushover_priority: "{{ notification_channel.pushover_priority | default(omit) }}"
        pushover_retry: "{{ notification_channel.pushover_retry | default(omit) }}"
        pushover_user_key: "{{ notification_channel.pushover_user_key | default(omit) }}"
        reminder_frequency: "{{ notification_channel.reminder_frequency | default(omit) }}"
        sensu_handler: "{{ notification_channel.sensu_handler | default(omit) }}"
        sensu_password: "{{ notification_channel.sensu_password | default(omit) }}"
        sensu_source: "{{ notification_channel.sensu_source | default(omit) }}"
        sensu_url: "{{ notification_channel.sensu_url | default(omit) }}"
        sensu_username: "{{ notification_channel.sensu_username | default(omit) }}"
        slack_icon_emoji: "{{ notification_channel.slack_icon_emoji | default(omit) }}"
        slack_icon_url: "{{ notification_channel.slack_icon_url | default(omit) }}"
        slack_mention_channel: "{{ notification_channel.slack_mention_channel | default(omit) }}"
        slack_mention_groups: "{{ notification_channel.slack_mention_groups | default(omit) }}"
        slack_mention_users: "{{ notification_channel.slack_mention_users | default(omit) }}"
        slack_recipient: "{{ notification_channel.slack_recipient | default(omit) }}"
        slack_token: "{{ notification_channel.slack_token | default(omit) }}"
        slack_url: "{{ notification_channel.slack_url | default(omit) }}"
        slack_username: "{{ notification_channel.slack_username | default(omit) }}"
        state: "{{ notification_channel.state | default(omit) }}"
        teams_url: "{{ notification_channel.teams_url | default(omit) }}"
        telegram_bot_token: "{{ notification_channel.telegram_bot_token | default(omit) }}"
        telegram_chat_id: "{{ notification_channel.telegram_chat_id | default(omit) }}"
        threema_api_secret: "{{ notification_channel.threema_api_secret | default(omit) }}"
        threema_gateway_id: "{{ notification_channel.threema_gateway_id | default(omit) }}"
        threema_recipient_id: "{{ notification_channel.threema_recipient_id | default(omit) }}"
        type: "{{ notification_channel.type }}"
        uid: "{{ notification_channel.uid | default(omit) }}"
        victorops_auto_resolve: "{{ notification_channel.victorops_auto_resolve | default(omit) }}"
        victorops_url: "{{ notification_channel.victorops_url | default(omit) }}"
        webhook_http_method: "{{ notification_channel.webhook_http_method | default(omit) }}"
        webhook_password: "{{ notification_channel.webhook_password | default(omit) }}"
        webhook_url: "{{ notification_channel.webhook_url | default(omit) }}"
        webhook_username: "{{ notification_channel.webhook_username | default(omit) }}"
      loop: "{{ grafana_notification_channels }}"
      loop_control: {loop_var: notification_channel}
      tags: notification_channel

    - name: Manage contact point
      community.grafana.grafana_contact_point:
        disable_resolve_message: "{{ contact_point.disable_resolve_message | default(omit) }}"
        include_image: "{{ contact_point.include_image | default(omit) }}"
        name: "{{ contact_point.name | default(omit) }}"
        org_id: "{{ contact_point.org_id | default(omit) }}"
        org_name: "{{ contact_point.org_name | default(omit) }}"
        provisioning: "{{ contact_point.provisioning | default(omit) }}"
        state: "{{ contact_point.state | default(omit) }}"
        type: "{{ contact_point.type | default(omit) }}"
        uid: "{{ contact_point.uid }}"
        alertmanager_password: "{{ contact_point.alertmanager_password | default(omit) }}"
        alertmanager_url: "{{ contact_point.alertmanager_url | default(omit) }}"
        alertmanager_username: "{{ contact_point.alertmanager_username | default(omit) }}"
        dingding_message: "{{ contact_point.dingding_message | default(omit) }}"
        dingding_message_type: "{{ contact_point.dingding_message_type | default(omit) }}"
        dingding_title: "{{ contact_point.dingding_title | default(omit) }}"
        dingding_url: "{{ contact_point.dingding_url | default(omit) }}"
        discord_avatar_url: "{{ contact_point.discord_avatar_url | default(omit) }}"
        discord_message: "{{ contact_point.discord_message | default(omit) }}"
        discord_title: "{{ contact_point.discord_title | default(omit) }}"
        discord_url: "{{ contact_point.discord_url | default(omit) }}"
        discord_use_username: "{{ contact_point.discord_use_username | default(omit) }}"
        email_addresses: "{{ contact_point.email_addresses | default(omit) }}"
        email_message: "{{ contact_point.email_message | default(omit) }}"
        email_single: "{{ contact_point.email_single | default(omit) }}"
        email_subject: "{{ contact_point.email_subject | default(omit) }}"
        googlechat_message: "{{ contact_point.googlechat_message | default(omit) }}"
        googlechat_title: "{{ contact_point.googlechat_title | default(omit) }}"
        googlechat_url: "{{ contact_point.googlechat_url | default(omit) }}"
        kafka_api_version: "{{ contact_point.kafka_api_version | default(omit) }}"
        kafka_cluster_id: "{{ contact_point.kafka_cluster_id | default(omit) }}"
        kafka_description: "{{ contact_point.kafka_description | default(omit) }}"
        kafka_details: "{{ contact_point.kafka_details | default(omit) }}"
        kafka_password: "{{ contact_point.kafka_password | default(omit) }}"
        kafka_rest_proxy_url: "{{ contact_point.kafka_rest_proxy_url | default(omit) }}"
        kafka_topic: "{{ contact_point.kafka_topic | default(omit) }}"
        kafka_username: "{{ contact_point.kafka_username | default(omit) }}"
        line_description: "{{ contact_point.line_description | default(omit) }}"
        line_title: "{{ contact_point.line_title | default(omit) }}"
        line_token: "{{ contact_point.line_token | default(omit) }}"
        opsgenie_api_key: "{{ contact_point.opsgenie_api_key | default(omit) }}"
        opsgenie_auto_close: "{{ contact_point.opsgenie_auto_close | default(omit) }}"
        opsgenie_description: "{{ contact_point.opsgenie_description | default(omit) }}"
        opsgenie_message: "{{ contact_point.opsgenie_message | default(omit) }}"
        opsgenie_override_priority: "{{ contact_point.opsgenie_override_priority | default(omit) }}"
        opsgenie_responders: "{{ contact_point.opsgenie_responders | default(omit) }}"
        opsgenie_send_tags_as: "{{ contact_point.opsgenie_send_tags_as | default(omit) }}"
        opsgenie_url: "{{ contact_point.opsgenie_url | default(omit) }}"
        pagerduty_class: "{{ contact_point.pagerduty_class | default(omit) }}"
        pagerduty_client: "{{ contact_point.pagerduty_client | default(omit) }}"
        pagerduty_client_url: "{{ contact_point.pagerduty_client_url | default(omit) }}"
        pagerduty_component: "{{ contact_point.pagerduty_component | default(omit) }}"
        pagerduty_details: "{{ contact_point.pagerduty_details | default(omit) }}"
        pagerduty_group: "{{ contact_point.pagerduty_group | default(omit) }}"
        pagerduty_integration_key: "{{ contact_point.pagerduty_integration_key | default(omit) }}"
        pagerduty_severity: "{{ contact_point.pagerduty_severity | default(omit) }}"
        pagerduty_source: "{{ contact_point.pagerduty_source | default(omit) }}"
        pagerduty_summary: "{{ contact_point.pagerduty_summary | default(omit) }}"
        pushover_api_token: "{{ contact_point.pushover_api_token | default(omit) }}"
        pushover_devices: "{{ contact_point.pushover_devices | default(omit) }}"
        pushover_expire: "{{ contact_point.pushover_expire | default(omit) }}"
        pushover_message: "{{ contact_point.pushover_message | default(omit) }}"
        pushover_ok_priority: "{{ contact_point.pushover_ok_priority | default(omit) }}"
        pushover_ok_sound: "{{ contact_point.pushover_ok_sound | default(omit) }}"
        pushover_priority: "{{ contact_point.pushover_priority | default(omit) }}"
        pushover_retry: "{{ contact_point.pushover_retry | default(omit) }}"
        pushover_sound: "{{ contact_point.pushover_sound | default(omit) }}"
        pushover_title: "{{ contact_point.pushover_title | default(omit) }}"
        pushover_upload_image: "{{ contact_point.pushover_upload_image | default(omit) }}"
        pushover_user_key: "{{ contact_point.pushover_user_key | default(omit) }}"
        sensugo_api_key: "{{ contact_point.sensugo_api_key | default(omit) }}"
        sensugo_check: "{{ contact_point.sensugo_check | default(omit) }}"
        sensugo_entity: "{{ contact_point.sensugo_entity | default(omit) }}"
        sensugo_handler: "{{ contact_point.sensugo_handler | default(omit) }}"
        sensugo_message: "{{ contact_point.sensugo_message | default(omit) }}"
        sensugo_namespace: "{{ contact_point.sensugo_namespace | default(omit) }}"
        sensugo_url: "{{ contact_point.sensugo_url | default(omit) }}"
        slack_endpoint_url: "{{ contact_point.slack_endpoint_url | default(omit) }}"
        slack_icon_emoji: "{{ contact_point.slack_icon_emoji | default(omit) }}"
        slack_icon_url: "{{ contact_point.slack_icon_url | default(omit) }}"
        slack_mention_channel: "{{ contact_point.slack_mention_channel | default(omit) }}"
        slack_mention_groups: "{{ contact_point.slack_mention_groups | default(omit) }}"
        slack_mention_users: "{{ contact_point.slack_mention_users | default(omit) }}"
        slack_recipient: "{{ contact_point.slack_recipient | default(omit) }}"
        slack_text: "{{ contact_point.slack_text | default(omit) }}"
        slack_title: "{{ contact_point.slack_title | default(omit) }}"
        slack_token: "{{ contact_point.slack_token | default(omit) }}"
        slack_url: "{{ contact_point.slack_url | default(omit) }}"
        slack_username: "{{ contact_point.slack_username | default(omit) }}"
        teams_message: "{{ contact_point.teams_message | default(omit) }}"
        teams_section_title: "{{ contact_point.teams_section_title | default(omit) }}"
        teams_title: "{{ contact_point.teams_title | default(omit) }}"
        teams_url: "{{ contact_point.teams_url | default(omit) }}"
        telegram_chat_id: "{{ contact_point.telegram_chat_id | default(omit) }}"
        telegram_disable_notifications: "{{ contact_point.telegram_disable_notifications | default(omit) }}"
        telegram_message: "{{ contact_point.telegram_message | default(omit) }}"
        telegram_parse_mode: "{{ contact_point.telegram_parse_mode | default(omit) }}"
        telegram_protect_content: "{{ contact_point.telegram_protect_content | default(omit) }}"
        telegram_token: "{{ contact_point.telegram_token | default(omit) }}"
        telegram_web_page_view: "{{ contact_point.telegram_web_page_view | default(omit) }}"
        threema_api_secret: "{{ contact_point.threema_api_secret | default(omit) }}"
        threema_description: "{{ contact_point.threema_description | default(omit) }}"
        threema_gateway_id: "{{ contact_point.threema_gateway_id | default(omit) }}"
        threema_recipient_id: "{{ contact_point.threema_recipient_id | default(omit) }}"
        threema_title: "{{ contact_point.threema_title | default(omit) }}"
        victorops_description: "{{ contact_point.victorops_description | default(omit) }}"
        victorops_message_type: "{{ contact_point.victorops_message_type | default(omit) }}"
        victorops_title: "{{ contact_point.victorops_title | default(omit) }}"
        victorops_url: "{{ contact_point.victorops_url | default(omit) }}"
        webex_api_url: "{{ contact_point.webex_api_url | default(omit) }}"
        webex_message: "{{ contact_point.webex_message | default(omit) }}"
        webex_room_id: "{{ contact_point.webex_room_id | default(omit) }}"
        webex_token: "{{ contact_point.webex_token | default(omit) }}"
        webhook_authorization_credentials: "{{ contact_point.webhook_authorization_credentials | default(omit) }}"
        webhook_authorization_scheme: "{{ contact_point.webhook_authorization_scheme | default(omit) }}"
        webhook_http_method: "{{ contact_point.webhook_http_method | default(omit) }}"
        webhook_max_alerts: "{{ contact_point.webhook_max_alerts | default(omit) }}"
        webhook_message: "{{ contact_point.webhook_message | default(omit) }}"
        webhook_password: "{{ contact_point.webhook_password | default(omit) }}"
        webhook_title: "{{ contact_point.webhook_title | default(omit) }}"
        webhook_url: "{{ contact_point.webhook_url | default(omit) }}"
        webhook_username: "{{ contact_point.webhook_username | default(omit) }}"
        wecom_agent_id: "{{ contact_point.wecom_agent_id | default(omit) }}"
        wecom_corp_id: "{{ contact_point.wecom_corp_id | default(omit) }}"
        wecom_message: "{{ contact_point.wecom_message | default(omit) }}"
        wecom_msg_type: "{{ contact_point.wecom_msg_type | default(omit) }}"
        wecom_secret: "{{ contact_point.wecom_secret | default(omit) }}"
        wecom_title: "{{ contact_point.wecom_title | default(omit) }}"
        wecom_to_user: "{{ contact_point.wecom_to_user | default(omit) }}"
        wecom_url: "{{ contact_point.wecom_url | default(omit) }}"
      loop: "{{ grafana_contact_points }}"
      loop_control: {loop_var: contact_point}
      tags: contact_point

    - name: Manage datasource
      community.grafana.grafana_datasource:
        access: "{{ datasource.access | default(omit) }}"
        additional_json_data: "{{ datasource.additional_json_data | default(omit) }}"
        additional_secure_json_data: "{{ datasource.additional_secure_json_data | default(omit) }}"
        aws_access_key: "{{ datasource.aws_access_key | default(omit) }}"
        aws_assume_role_arn: "{{ datasource.aws_assume_role_arn | default(omit) }}"
        aws_auth_type: "{{ datasource.aws_auth_type | default(omit) }}"
        aws_credentials_profile: "{{ datasource.aws_credentials_profile | default(omit) }}"
        aws_custom_metrics_namespaces: "{{ datasource.aws_custom_metrics_namespaces | default(omit) }}"
        aws_default_region: "{{ datasource.aws_default_region | default(omit) }}"
        aws_secret_key: "{{ datasource.aws_secret_key | default(omit) }}"
        azure_client: "{{ datasource.azure_client | default(omit) }}"
        azure_cloud: "{{ datasource.azure_cloud | default(omit) }}"
        azure_secret: "{{ datasource.azure_secret | default(omit) }}"
        azure_tenant: "{{ datasource.azure_tenant | default(omit) }}"
        basic_auth_password: "{{ datasource.basic_auth_password | default(omit) }}"
        basic_auth_user: "{{ datasource.basic_auth_user | default(omit) }}"
        database: "{{ datasource.database | default(omit) }}"
        ds_type: "{{ datasource.ds_type | default(omit) }}"
        ds_url: "{{ datasource.ds_url | default(omit) }}"
        enforce_secure_data: "{{ datasource.enforce_secure_data | default(omit) }}"
        es_version: "{{ datasource.es_version | default(omit) }}"
        interval: "{{ datasource.interval | default(omit) }}"
        is_default: "{{ datasource.is_default | default(omit) }}"
        max_concurrent_shard_requests: "{{ datasource.max_concurrent_shard_requests | default(omit) }}"
        name: "{{ datasource.name }}"
        org_id: "{{ datasource.org_id | default(omit) }}"
        org_name: "{{ datasource.org_name | default(omit) }}"
        password: "{{ datasource.password | default(omit) }}"
        sslmode: "{{ datasource.sslmode | default(omit) }}"
        state: "{{ datasource.state | default(omit) }}"
        time_field: "{{ datasource.time_field | default(omit) }}"
        time_interval: "{{ datasource.time_interval | default(omit) }}"
        tls_ca_cert: "{{ datasource.tls_ca_cert | default(omit) }}"
        tls_client_cert: "{{ datasource.tls_client_cert | default(omit) }}"
        tls_client_key: "{{ datasource.tls_client_key | default(omit) }}"
        tls_skip_verify: "{{ datasource.tls_skip_verify | default(omit) }}"
        trends: "{{ datasource.trends | default(omit) }}"
        tsdb_resolution: "{{ datasource.tsdb_resolution | default(omit) }}"
        tsdb_version: "{{ datasource.tsdb_version | default(omit) }}"
        uid: "{{ datasource.uid | default(omit) }}"
        user: "{{ datasource.user | default(omit) }}"
        with_credentials: "{{ datasource.with_credentials | default(omit) }}"
        zabbix_password: "{{ datasource.zabbix_password | default(omit) }}"
        zabbix_user: "{{ datasource.zabbix_user | default(omit) }}"
      loop: "{{ grafana_datasources }}"
      loop_control: {loop_var: datasource}
      tags: datasource

    - name: Manage folder  # noqa: args[module]
      community.grafana.grafana_folder:
        name: "{{ folder.name }}"
        org_id: "{{ folder.org_id | default(omit) }}"
        org_name: "{{ folder.org_name | default(omit) }}"
        parent_uid: "{{ folder.parent_uid | default(omit) }}"
        skip_version_check: "{{ folder.skip_version_check | default(omit) }}"
        state: "{{ folder.state | default(omit) }}"
        uid: "{{ folder.uid | default(omit) }}"
      loop: "{{ grafana_folders }}"
      loop_control: {loop_var: folder}
      tags: folder

    - name: Manage team  # noqa: args[module]
      community.grafana.grafana_team:
        email: "{{ team.email }}"
        enforce_members: "{{ team.enforce_members | default(omit) }}"
        members: "{{ team.members | default(omit) }}"
        name: "{{ team.name }}"
        skip_version_check: "{{ team.skip_version_check | default(omit) }}"
        state: "{{ team.state | default(omit) }}"
      loop: "{{ grafana_teams }}"
      loop_control: {loop_var: team}
      tags: team

    - name: Manage user  # noqa: args[module]
      community.grafana.grafana_user:
        email: "{{ user.email | default(omit) }}"
        is_admin: "{{ user.is_admin | default(omit) }}"
        login: "{{ user.login }}"
        name: "{{ user.name }}"
        password: "{{ user.password | default(omit) }}"
        state: "{{ user.state | default(omit) }}"
      loop: "{{ grafana_users }}"
      loop_control: {loop_var: user}
      tags: user

    - name: Manage organization users
      community.grafana.grafana_organization_user:
        login: "{{ organization_user.login }}"
        org_id: "{{ organization_user.org_id | default(omit) }}"
        org_name: "{{ organization_user.org_name | default(omit) }}"
        role: "{{ organization_user.role | default(omit) }}"
        state: "{{ organization_user.state | default(omit) }}"
      loop: "{{ grafana_organization_users }}"
      loop_control: {loop_var: organization_user}
      tags: organization_user

    - name: Manage dashboard
      community.grafana.grafana_dashboard:
        commit_message: "{{ dashboard.commit_message | default(omit) }}"
        dashboard_id: "{{ dashboard.dashboard_id | default(omit) }}"
        dashboard_revision: "{{ dashboard.dashboard_revision | default(omit) }}"
        folder: "{{ dashboard.folder | default(omit) }}"
        parent_folder: "{{ dashboard.parent_folder | default(omit) }}"
        org_id: "{{ dashboard.org_id | default(omit) }}"
        org_name: "{{ dashboard.org_name | default(omit) }}"
        overwrite: "{{ dashboard.overwrite | default(omit) }}"
        path: "{{ dashboard.path | default(omit) }}"
        slug: "{{ dashboard.slug | default(omit) }}"
        state: "{{ dashboard.state | default(omit) }}"
        uid: "{{ dashboard.uid | default(omit) }}"
      loop: "{{ grafana_dashboards }}"
      loop_control: {loop_var: dashboard}
      tags: [dashboard, molecule-idempotence-notest]

    - name: Manage silence
      community.grafana.grafana_silence:
        comment: "{{ silence.comment }}"
        created_by: "{{ silence.created_by }}"
        ends_at: "{{ silence.ends_at }}"
        matchers: "{{ silence.matchers }}"
        org_id: "{{ silence.org_id | default(omit) }}"
        org_name: "{{ silence.org_name | default(omit) }}"
        starts_at: "{{ silence.starts_at }}"
        state: "{{ silence.state | default(omit) }}"
      loop: "{{ grafana_silences }}"
      loop_control: {loop_var: silence}
      tags: silence
